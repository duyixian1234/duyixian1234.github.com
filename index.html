<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="我的技术博客">
<meta property="og:type" content="website">
<meta property="og:title" content="那时难决">
<meta property="og:url" content="http:&#x2F;&#x2F;duyixian1234.github.io&#x2F;index.html">
<meta property="og:site_name" content="那时难决">
<meta property="og:description" content="我的技术博客">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://duyixian1234.github.io/"/>





  <title>那时难决</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">那时难决</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            Commonweal 404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://duyixian1234.github.io/2020/03/05/%E5%88%9D%E8%AF%86Python3-7%E4%B8%AD%E7%9A%84dataclasses%E6%A0%87%E5%87%86%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="杜逸先">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="那时难决">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/%E5%88%9D%E8%AF%86Python3-7%E4%B8%AD%E7%9A%84dataclasses%E6%A0%87%E5%87%86%E5%BA%93/" itemprop="url">初识Python3.7的dataclasses标准库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-05T16:50:06+08:00">
                2020-03-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="初识-Python3-7-的-dataclasses-标准库"><a href="#初识-Python3-7-的-dataclasses-标准库" class="headerlink" title="初识 Python3.7 的 dataclasses 标准库"></a>初识 Python3.7 的 dataclasses 标准库</h1><p>最近在进行一个新的后端项目时想初步应用一下领域驱动设计的思想。DDD 开发需要对一个领域对象进行各种操作，而不是把业务数据包在<code>dict</code>里在 <code>action</code> 层,<code>repo</code> 层中传来传去。如何方便高效地定义实体类成为一个重要前提。Python 3.7 版本引入的新标准库 dataclasses 可以帮助我们解决这个问题。</p>
<h2 id="1-dataclasses-的简介和使用"><a href="#1-dataclasses-的简介和使用" class="headerlink" title="1. dataclasses 的简介和使用"></a>1. dataclasses 的简介和使用</h2><p>dataclasses 的官方介绍是：</p>
<blockquote>
<p>This module provides a decorator and functions for automatically adding generated special methods such as <strong>init</strong>() and <strong>repr</strong>() to user-defined classes. It was originally described in PEP 557.</p>
</blockquote>
<p>使用 dataclasses 我们可以很方便地利用类型注解类定义数据类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InventoryItem</span>:</span></span><br><span class="line">    <span class="string">'''Class for keeping track of an item in inventory.'''</span></span><br><span class="line">    name: str</span><br><span class="line">    unit_price: float</span><br><span class="line">    quantity_on_hand: int = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">total_cost</span><span class="params">(self)</span> -&gt; float:</span></span><br><span class="line">        <span class="keyword">return</span> self.unit_price * self.quantity_on_hand</span><br></pre></td></tr></table></figure>

<p>使用了<code>dataclass</code>函数装饰器装饰<code>InventoryItem</code>类后，会生成<code>__init__</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name: str, unit_price: float, quantity_on_hand: int=<span class="number">0</span>)</span>:</span></span><br><span class="line">    self.name = name</span><br><span class="line">    self.unit_price = unit_price</span><br><span class="line">    self.quantity_on_hand = quantity_on_hand</span><br></pre></td></tr></table></figure>

<p>然后就可以直接实例化<code>InventoryItem</code>对象<code>InventoryItem(&#39;apple&#39;,1,10),InventoryItem(&#39;banana&#39;,1,quantity_on_hand=10)</code></p>
<p>实际上<code>dataclass</code>函数是有很多参数的:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclasses.dataclass(*, init=True, repr=True, eq=True, order=False, unsafe_hash=False, frozen=False)</span></span><br></pre></td></tr></table></figure>

<p>这里介绍一下比较常用的参数：</p>
<ul>
<li>init:是否生成<code>__init__</code>方法，如果用户手动定义的<code>__init__</code>方法，这个属性会被忽略。</li>
<li>repr:是否生成<code>__repr__</code>方法。</li>
<li>eq:是否生成<code>__eq__</code>方法以用’==’比较不同实例，会按定义顺序比较对象中的字段。</li>
<li>order:是否生成<code>lt</code>,<code>gt</code>等方法用于比较不同实例。</li>
<li>frozen:默认为 <code>False</code>,设置为 <code>True</code> 的话对这个类实例的字段进行复制会抛出异常，相当于定义一个不可变对象</li>
</ul>
<p>上文定义的<code>InventoryItem</code>类没有指定参数，全部是默认参数，具体的表现行为如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line">   ...: @dataclass</span><br><span class="line">   ...: <span class="class"><span class="keyword">class</span> <span class="title">InventoryItem</span>:</span></span><br><span class="line">   ...:     <span class="string">'''Class for keeping track of an item in inventory.'''</span></span><br><span class="line">   ...:     name: str</span><br><span class="line">   ...:     unit_price: float</span><br><span class="line">   ...:     quantity_on_hand: int = <span class="number">0</span></span><br><span class="line">   ...:</span><br><span class="line">   ...:     <span class="function"><span class="keyword">def</span> <span class="title">total_cost</span><span class="params">(self)</span> -&gt; float:</span></span><br><span class="line">   ...:         <span class="keyword">return</span> self.unit_price * self.quantity_on_hand</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: a = InventoryItem(<span class="string">'a'</span>,<span class="number">1</span>,<span class="number">10</span>) <span class="comment"># 定义了__init__方法</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: b = InventoryItem(<span class="string">'b'</span>,<span class="number">2</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: a <span class="comment"># 定义了__repr__方法</span></span><br><span class="line">Out[<span class="number">4</span>]: InventoryItem(name=<span class="string">'a'</span>, unit_price=<span class="number">1</span>, quantity_on_hand=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: a == b <span class="comment"># 定义了__eq__方法</span></span><br><span class="line">Out[<span class="number">5</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: a == InventoryItem(<span class="string">'a'</span>,<span class="number">1</span>,<span class="number">10</span>)</span><br><span class="line">Out[<span class="number">6</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: a &lt; b <span class="comment"># 没有定义'__lt__'f方法</span></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-7</span>-c41276b34900&gt; <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">----&gt; 1 a &lt; b # 没有定义'__lt__'方法</span><br><span class="line"></span><br><span class="line">TypeError: <span class="string">'&lt;'</span> <span class="keyword">not</span> supported between instances of <span class="string">'InventoryItem'</span> <span class="keyword">and</span> <span class="string">'InventoryItem'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: a.name = <span class="string">'aa'</span> <span class="comment"># forzen 属性为False,可以修改字段</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: a</span><br><span class="line">Out[<span class="number">9</span>]: InventoryItem(name=<span class="string">'aa'</span>, unit_price=<span class="number">1</span>, quantity_on_hand=<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-使用dataclasses-field修饰字段"><a href="#2-使用dataclasses-field修饰字段" class="headerlink" title="2. 使用dataclasses.field修饰字段"></a>2. 使用<code>dataclasses.field</code>修饰字段</h2><p>事实上我们不仅可以通过对 dataclass 的参数定义数据类的整体表现，也可以指定具体字段的行为，只需要用到<code>dataclasses.field</code>函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataclasses.field(*, default=MISSING, default_factory=MISSING,\</span><br><span class="line"> repr=<span class="literal">True</span>, hash=<span class="literal">None</span>, init=<span class="literal">True</span>, compare=<span class="literal">True</span>, metadata=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>介绍一下<code>field</code>函数的常用参数：</p>
<ul>
<li>default: 设置默认值</li>
<li>default_factory: 设置默认工厂函数</li>
<li>repr: 在<code>__repr__</code>方法中是否展示这个字段</li>
<li>init: 在<code>__init__</code>方法中是否需要初始化这个字段</li>
</ul>
<p>其中<code>default_factory</code>属性在一些情况下作用相当大。例如我们定义如下数据类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    nums:list = []</span><br></pre></td></tr></table></figure>

<p>如果一切正常的话我们实例化两个对象<code>a</code>和<code>b</code>，然后<code>a.nums.append(1)</code>，<code>b.nums.append(2)</code>，此时<code>a.nums == b.nums == [1, 2]</code>,因为<code>a.num</code>和<code>b.num</code>实际指向的都是定义<code>A</code>时初始化过的那个空列表。</p>
<p>好在上述代码是无法运行的，会抛出异常<code>ValueError: mutable default &lt;class &#39;list&#39;&gt; for field nums is not allowed: use default_factory</code>。按照提示，我们应该制定<code>nums</code>的默认工厂函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass,field</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: @dataclass</span><br><span class="line">   ...: <span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">   ...:     nums:list = field(default_factory=list)</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: a = A()</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: b = A()</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: a.nums.append(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: b.nums.append(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: a.nums, b.nums</span><br><span class="line">Out[<span class="number">7</span>]: ([<span class="number">1</span>], [<span class="number">2</span>])</span><br></pre></td></tr></table></figure>

<p>我们指定了<code>nums</code>字段的默认工厂函数是<code>list</code>,每次实例化对象的时候，都会重新调用一次<code>list</code>方法生成一个新的空列表给<code>nums</code>,从而符合我们的预期。</p>
<h2 id="3-使用dataclasses-asdict转换对象到dict"><a href="#3-使用dataclasses-asdict转换对象到dict" class="headerlink" title="3. 使用dataclasses.asdict转换对象到dict"></a>3. 使用<code>dataclasses.asdict</code>转换对象到<code>dict</code></h2><p>我们经常会遇到需要持久化复杂数据对象的情况，比如存到数据库或者转化为<code>json</code>输出到前端。如果能方便的将对象转换成<code>dict</code>的话会很大的提高开发效率，幸运的是标准库提供了<code>dataclasses.asdict</code>函数。</p>
<p>我们来定义一个稍微复杂一点的数据类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    a:int</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    name:str</span><br><span class="line">    a_list:List[A]</span><br></pre></td></tr></table></figure>

<p>如果要手动把<code>B</code>类型对象转化为<code>dict</code>的话，我们大概要这样做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_dict</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'name'</span>:self.name, <span class="string">'a_list'</span>:[&#123;<span class="string">'a'</span>:x.a&#125; <span class="keyword">for</span> x <span class="keyword">in</span> self.a_list]&#125;</span><br></pre></td></tr></table></figure>

<p>这样的<code>to_dict</code>方法偶尔实现一次两次倒也罢了，如果每个数据类都要手动实现一个<code>to_dict</code>方法的话就太过浪费时间和精力了。使用<code>dataclasses.asdict</code>方法可以极大地提高我们的效率。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass,asdict</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: <span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: @dataclass</span><br><span class="line">   ...: <span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">   ...:     a:int</span><br><span class="line">   ...:</span><br><span class="line">   ...: @dataclass</span><br><span class="line">   ...: <span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">   ...:     name:str</span><br><span class="line">   ...:     a_list:List[A]</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: b = B(name=<span class="string">'b'</span>,a_list=[A(<span class="number">1</span>),A(<span class="number">2</span>),A(<span class="number">3</span>)])</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: b</span><br><span class="line">Out[<span class="number">5</span>]: B(name=<span class="string">'b'</span>, a_list=[A(a=<span class="number">1</span>), A(a=<span class="number">2</span>), A(a=<span class="number">3</span>)])</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: asdict(b)</span><br><span class="line">Out[<span class="number">6</span>]: &#123;<span class="string">'name'</span>: <span class="string">'b'</span>, <span class="string">'a_list'</span>: [&#123;<span class="string">'a'</span>: <span class="number">1</span>&#125;, &#123;<span class="string">'a'</span>: <span class="number">2</span>&#125;, &#123;<span class="string">'a'</span>: <span class="number">3</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-使用-post-init-方法进行一些初始化操作"><a href="#4-使用-post-init-方法进行一些初始化操作" class="headerlink" title="4. 使用__post_init__方法进行一些初始化操作"></a>4. 使用<code>__post_init__</code>方法进行一些初始化操作</h2><p>使用<code>dataclass</code>装饰的类一个主要优势就是不用手动去实现<code>__init__</code>方法，但我们经常需要在对象初始化的时候对一些数据进行校验或者额外操作，此时一个选择是手动实现<code>__init__</code>方法，其中会有大段的模板代码例如<code>self.a=a;self.b=b</code>，另一个选择是定义<code>__post_init__</code>方法来进行初始化操作，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: @dataclass</span><br><span class="line">   ...: <span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">   ...:     name:str</span><br><span class="line">   ...:     age:int</span><br><span class="line">   ...:</span><br><span class="line">   ...:     <span class="function"><span class="keyword">def</span> <span class="title">__post_init__</span><span class="params">(self)</span>:</span></span><br><span class="line">   ...:         <span class="keyword">if</span> self.age &lt; <span class="number">0</span>:</span><br><span class="line">   ...:             <span class="keyword">raise</span> ValueError(<span class="string">'Age &lt; 0'</span>)</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: Person(<span class="string">'Mike'</span>,<span class="number">-1</span>)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">ValueError                                Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-3</span><span class="number">-4</span>b4379de6be2&gt; <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">----&gt; 1 Person('Mike',-1)</span><br><span class="line"></span><br><span class="line">&lt;string&gt; <span class="keyword">in</span> __init__(self, name, age)</span><br><span class="line"></span><br><span class="line">&lt;ipython-input<span class="number">-2</span><span class="number">-1e8016803</span>a1d&gt; <span class="keyword">in</span> __post_init__(self)</span><br><span class="line">      <span class="number">6</span>     <span class="function"><span class="keyword">def</span> <span class="title">__post_init__</span><span class="params">(self)</span>:</span></span><br><span class="line">      <span class="number">7</span>         <span class="keyword">if</span> self.age &lt; <span class="number">0</span>:</span><br><span class="line">----&gt; 8             raise ValueError('Age &lt; 0')</span><br><span class="line">      <span class="number">9</span></span><br><span class="line"></span><br><span class="line">ValueError: Age &lt; <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>今天向大家介绍了 Python 3.7 中<code>dataclasses</code>标准库的简单使用。<br>作为一个以灵活著称的编程语言，我们使用 Python 处理结构化数据的时候经常会使用<code>dict</code>在不同模块间传来传去，然后在需要的地方进行数据的校验和格式转换，无意间会增加很多相似的代码，真正的核心逻辑淹没在这些校验和转换过程中，单元测试的复杂度也随之提高。<br>利用新版本 Python 的类型提示和 dataclasses 标准库，配合一些开发工具（mypy,pylint 等）我们可以较为放心地将数据对象在不同模块方法间传递使用，有助于改进 Python 在大型项目下的开发效率和安全性。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://duyixian1234.github.io/2020/03/05/%E5%88%9D%E8%AF%86Python3-7%E7%9A%84dataclass/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="杜逸先">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="那时难决">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/%E5%88%9D%E8%AF%86Python3-7%E7%9A%84dataclass/" itemprop="url">初识Python3.7的dataclass</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-05T16:50:06+08:00">
                2020-03-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="初识-Python3-7-的-dataclass"><a href="#初识-Python3-7-的-dataclass" class="headerlink" title="初识 Python3.7 的 dataclass"></a>初识 Python3.7 的 dataclass</h1><p>最近在进行一个新的后端项目时想初步应用一下领域驱动设计 DDD 的思想。DDD 开发需要对一个领域对象进行各种操作，而不是把业务数据包在<code>dict</code>里在 action 层,repo 层中传来传去，要能够比较方便地定义各种实体类，Python 3.7 版本引入的新标准库 dataclasses 可以帮助我们解决这个问题。</p>
<h2 id="dataclasses-的简介和使用"><a href="#dataclasses-的简介和使用" class="headerlink" title="dataclasses 的简介和使用"></a>dataclasses 的简介和使用</h2><p>dataclasses 的官方介绍是：</p>
<blockquote>
<p>This module provides a decorator and functions for automatically adding generated special methods such as <strong>init</strong>() and <strong>repr</strong>() to user-defined classes. It was originally described in PEP 557.</p>
</blockquote>
<p>使用 dataclasses 我们可以很方便地利用类型注解类定义数据类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InventoryItem</span>:</span></span><br><span class="line">    <span class="string">'''Class for keeping track of an item in inventory.'''</span></span><br><span class="line">    name: str</span><br><span class="line">    unit_price: float</span><br><span class="line">    quantity_on_hand: int = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">total_cost</span><span class="params">(self)</span> -&gt; float:</span></span><br><span class="line">        <span class="keyword">return</span> self.unit_price * self.quantity_on_hand</span><br></pre></td></tr></table></figure>

<p>使用了<code>dataclass</code>函数装饰器装饰<code>InventoryItem</code>类后，会生成这样的<code>__init__</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name: str, unit_price: float, quantity_on_hand: int=<span class="number">0</span>)</span>:</span></span><br><span class="line">    self.name = name</span><br><span class="line">    self.unit_price = unit_price</span><br><span class="line">    self.quantity_on_hand = quantity_on_hand</span><br></pre></td></tr></table></figure>

<p>实际上<code>dataclass</code>函数是有很多参数的:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclasses.dataclass(*, init=True, repr=True, eq=True, order=False, unsafe_hash=False, frozen=False)</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://duyixian1234.github.io/2020/02/23/%E6%9C%80%E5%85%A8%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%E9%9C%80%E8%A6%81%E7%9A%84%E5%90%84%E7%B1%BB%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="杜逸先">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="那时难决">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/23/%E6%9C%80%E5%85%A8%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%E9%9C%80%E8%A6%81%E7%9A%84%E5%90%84%E7%B1%BB%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/" itemprop="url">最全日常开发中需要的各类国内镜像仓库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-23T00:25:57+08:00">
                2020-02-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="常用国内镜像地址和使用方式"><a href="#常用国内镜像地址和使用方式" class="headerlink" title="常用国内镜像地址和使用方式"></a>常用国内镜像地址和使用方式</h1><h2 id="Pypi"><a href="#Pypi" class="headerlink" title="Pypi"></a>Pypi</h2><h3 id="镜像地址"><a href="#镜像地址" class="headerlink" title="镜像地址"></a>镜像地址</h3><table>
<thead>
<tr>
<th>镜像</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>豆瓣</td>
<td><a href="https://pypi.doubanio.com/simple/" target="_blank" rel="noopener">https://pypi.doubanio.com/simple/</a></td>
</tr>
<tr>
<td>阿里云</td>
<td><a href="https://mirrors.aliyun.com/pypi/simple" target="_blank" rel="noopener">https://mirrors.aliyun.com/pypi/simple</a></td>
</tr>
<tr>
<td>腾讯云</td>
<td><a href="https://mirrors.cloud.tencent.com/pypi/simple" target="_blank" rel="noopener">https://mirrors.cloud.tencent.com/pypi/simple</a></td>
</tr>
</tbody></table>
<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><h4 id="临时使用"><a href="#临时使用" class="headerlink" title="临时使用"></a>临时使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask -i https://pypi.doubanio.com/simple/</span><br></pre></td></tr></table></figure>

<h4 id="requirements-txt"><a href="#requirements-txt" class="headerlink" title="requirements.txt"></a>requirements.txt</h4><p>第一行加入：</p>
<blockquote>
<p>-i <a href="https://pypi.doubanio.com/simple/" target="_blank" rel="noopener">https://pypi.doubanio.com/simple/</a><br>flask</p>
</blockquote>
<h4 id="设置为默认"><a href="#设置为默认" class="headerlink" title="设置为默认"></a>设置为默认</h4><p>修改<code>$HOME/.config/pip/pip.conf</code></p>
<blockquote>
<p>[global]<br>timeout = 60<br>index-url = <a href="https://pypi.doubanio.com/simple/" target="_blank" rel="noopener">https://pypi.doubanio.com/simple/</a></p>
</blockquote>
<h2 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a>NPM</h2><h3 id="镜像地址-1"><a href="#镜像地址-1" class="headerlink" title="镜像地址"></a>镜像地址</h3><table>
<thead>
<tr>
<th>镜像</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>阿里</td>
<td><a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></td>
</tr>
<tr>
<td>腾讯云</td>
<td><a href="http://mirrors.cloud.tencent.com/npm/" target="_blank" rel="noopener">http://mirrors.cloud.tencent.com/npm/</a></td>
</tr>
<tr>
<td>华为</td>
<td><a href="https://mirrors.huaweicloud.com/repository/npm/" target="_blank" rel="noopener">https://mirrors.huaweicloud.com/repository/npm/</a></td>
</tr>
</tbody></table>
<h3 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式"></a>使用方式</h3><h4 id="临时使用-1"><a href="#临时使用-1" class="headerlink" title="临时使用"></a>临时使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g yarn --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<h4 id="设置为默认-1"><a href="#设置为默认-1" class="headerlink" title="设置为默认"></a>设置为默认</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line">npm config get registry <span class="comment"># 验证</span></span><br></pre></td></tr></table></figure>

<h4 id="使用-nrm"><a href="#使用-nrm" class="headerlink" title="使用 nrm"></a>使用 nrm</h4><p>可以选择一个最快的镜像仓库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ npm install -g nrm</span><br><span class="line"></span><br><span class="line">➜  ~ nrm ls</span><br><span class="line"></span><br><span class="line">  npm -------- https://registry.npmjs.org/</span><br><span class="line">  yarn ------- https://registry.yarnpkg.com/</span><br><span class="line">  cnpm ------- http://r.cnpmjs.org/</span><br><span class="line">* taobao ----- https://registry.npm.taobao.org/</span><br><span class="line">  nj --------- https://registry.nodejitsu.com/</span><br><span class="line">  npmMirror -- https://skimdb.npmjs.com/registry/</span><br><span class="line">  edunpm ----- http://registry.enpmjs.org/</span><br><span class="line"></span><br><span class="line">➜  ~ nrm <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">  npm ---- 1419ms</span><br><span class="line">  yarn --- 1859ms</span><br><span class="line">  cnpm --- 238ms</span><br><span class="line">* taobao - 206ms</span><br><span class="line">  nj ----- Fetch Error</span><br><span class="line">  npmMirror  4480ms</span><br><span class="line">  edunpm - Fetch Error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜  ~ nrm use taobao</span><br><span class="line"></span><br><span class="line">   Registry has been <span class="built_in">set</span> to: https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure>

<h2 id="docker-repository"><a href="#docker-repository" class="headerlink" title="docker repository"></a>docker repository</h2><h3 id="镜像地址-2"><a href="#镜像地址-2" class="headerlink" title="镜像地址"></a>镜像地址</h3><table>
<thead>
<tr>
<th>镜像</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>中科大</td>
<td><a href="https://docker.mirrors.ustc.edu.cn/" target="_blank" rel="noopener">https://docker.mirrors.ustc.edu.cn/</a></td>
</tr>
<tr>
<td>Azure</td>
<td><a href="https://dockerhub.azk8s.cn/" target="_blank" rel="noopener">https://dockerhub.azk8s.cn/</a></td>
</tr>
</tbody></table>
<h3 id="使用方式-2"><a href="#使用方式-2" class="headerlink" title="使用方式"></a>使用方式</h3><h4 id="临时使用-2"><a href="#临时使用-2" class="headerlink" title="临时使用"></a>临时使用</h4><p><em>注意</em> 不用加<code>https://</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull dockerhub.azk8s.cn/library/redis:latest <span class="comment"># 官方镜像</span></span><br><span class="line">docker pull dockerhub.azk8s.cn/gitea/gitea:latest <span class="comment"># 第三方镜像</span></span><br></pre></td></tr></table></figure>

<h4 id="设置为默认-2"><a href="#设置为默认-2" class="headerlink" title="设置为默认"></a>设置为默认</h4><p>编辑<code>/etc/docker/daemon.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">"registry-mirrors"</span>: [<span class="string">"https://dockerhub.azk8s.cn/"</span>] &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><h3 id="镜像地址-3"><a href="#镜像地址-3" class="headerlink" title="镜像地址"></a>镜像地址</h3><table>
<thead>
<tr>
<th>镜像</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>阿里</td>
<td><a href="http://maven.aliyun.com/nexus/content/groups/public/" target="_blank" rel="noopener">http://maven.aliyun.com/nexus/content/groups/public/</a></td>
</tr>
<tr>
<td>腾讯云</td>
<td><a href="http://mirrors.cloud.tencent.com/nexus/repository/maven-public/" target="_blank" rel="noopener">http://mirrors.cloud.tencent.com/nexus/repository/maven-public/</a></td>
</tr>
</tbody></table>
<h3 id="使用方式-3"><a href="#使用方式-3" class="headerlink" title="使用方式"></a>使用方式</h3><h4 id="设置为默认-3"><a href="#设置为默认-3" class="headerlink" title="设置为默认"></a>设置为默认</h4><p>maven 修改 setting.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  　　<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Goproxy"><a href="#Goproxy" class="headerlink" title="Goproxy"></a>Goproxy</h2><h3 id="镜像地址-4"><a href="#镜像地址-4" class="headerlink" title="镜像地址"></a>镜像地址</h3><table>
<thead>
<tr>
<th>镜像</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>阿里</td>
<td><a href="https://mirrors.aliyun.com/goproxy/" target="_blank" rel="noopener">https://mirrors.aliyun.com/goproxy/</a></td>
</tr>
<tr>
<td>七牛</td>
<td><a href="https://goproxy.cn" target="_blank" rel="noopener">https://goproxy.cn</a></td>
</tr>
</tbody></table>
<h3 id="使用方式-4"><a href="#使用方式-4" class="headerlink" title="使用方式"></a>使用方式</h3><h4 id="设置为默认-4"><a href="#设置为默认-4" class="headerlink" title="设置为默认"></a>设置为默认</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用 Go Modules 功能</span></span><br><span class="line">go env -w GO111MODULE=on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 GOPROXY 环境变量，以下三选一</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 官方</span></span><br><span class="line">go env -w  GOPROXY=https://goproxy.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 七牛 CDN</span></span><br><span class="line">go env -w  GOPROXY=https://goproxy.cn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 阿里云</span></span><br><span class="line">go env -w GOPROXY=https://mirrors.aliyun.com/goproxy/</span><br></pre></td></tr></table></figure>

<h2 id="PHP-Composer"><a href="#PHP-Composer" class="headerlink" title="PHP Composer"></a>PHP Composer</h2><h3 id="镜像地址-5"><a href="#镜像地址-5" class="headerlink" title="镜像地址"></a>镜像地址</h3><table>
<thead>
<tr>
<th>镜像</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>官方</td>
<td><a href="https://packagist.phpcomposer.com" target="_blank" rel="noopener">https://packagist.phpcomposer.com</a></td>
</tr>
<tr>
<td>腾讯云</td>
<td><a href="https://mirrors.cloud.tencent.com/composer/" target="_blank" rel="noopener">https://mirrors.cloud.tencent.com/composer/</a></td>
</tr>
</tbody></table>
<h3 id="使用方式-5"><a href="#使用方式-5" class="headerlink" title="使用方式"></a>使用方式</h3><h4 id="设置为默认-5"><a href="#设置为默认-5" class="headerlink" title="设置为默认"></a>设置为默认</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g repos.packagist composer https://mirrors.cloud.tencent.com/composer/</span><br></pre></td></tr></table></figure>

<h3 id="制定项目"><a href="#制定项目" class="headerlink" title="制定项目"></a>制定项目</h3><p>修改当前项目的 composer.json 配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config repo.packagist composer https://packagist.phpcomposer.com</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://duyixian1234.github.io/2019/11/22/%E6%AF%94%E8%BE%83Python%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F%E5%92%8Cmap-filter-%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="杜逸先">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="那时难决">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/22/%E6%AF%94%E8%BE%83Python%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F%E5%92%8Cmap-filter-%E5%87%BD%E6%95%B0/" itemprop="url">比较Python中的列表推导式和map(),filter()函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-22T10:21:17+08:00">
                2019-11-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="比较Python中的列表推导式和map-reduce-函数"><a href="#比较Python中的列表推导式和map-reduce-函数" class="headerlink" title="比较Python中的列表推导式和map(),reduce()函数"></a>比较Python中的列表推导式和map(),reduce()函数</h1><p>对一个列表（迭代器）中的元素进行批量处理是一个很常见的业务需求，在Python中，一般有三种解决方案：<code>for</code>循环，列表推导式，或者<code>map()</code>,<code>filter()</code>函数。</p>
<p>例如我们计算一下100以内奇数的平方和。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for loop</span></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">if</span> x % <span class="number">2</span>:</span><br><span class="line">        total += x * x</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># list comprehension</span></span><br><span class="line">sum(x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">100</span>) <span class="keyword">if</span> x % <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># map(), filter()</span></span><br><span class="line">sum(map(<span class="keyword">lambda</span> x: x * x, filter(<span class="keyword">lambda</span> x: x % <span class="number">2</span>, range(<span class="number">100</span>))))</span><br></pre></td></tr></table></figure>

<p><code>for</code>循环方案最容易理解但有些繁琐，列表推导式方案就简洁了很多，<code>map()</code>,<code>filter()</code>方案存在一个问题就是要理解它们嵌套关系和执行顺序。</p>
<p>三种方案的效率也可以进行一下比较。</p>
<p><img src="/image/0001.png" alt=""></p>
<p>可以看到for循环和列表推导式的效率是相近的，而<code>map()</code>,<code>filter()</code>方案就慢很多，这是因为<code>map()</code>,<code>filter()</code>方案中进行了大量的函数调用，而Python解释器对列表推导式有专门的优化。</p>
<p>我按照自己的尺度给三种方案做了一个评价。</p>
<table>
<thead>
<tr>
<th>方案</th>
<th>可理解度</th>
<th>简洁度</th>
<th>执行效率</th>
</tr>
</thead>
<tbody><tr>
<td>for loop</td>
<td>★★★</td>
<td>★</td>
<td>★★★</td>
</tr>
<tr>
<td>list comprehension</td>
<td>★★</td>
<td>★★★</td>
<td>★★★</td>
</tr>
<tr>
<td>map(),filter()</td>
<td>★★</td>
<td>★★</td>
<td>★</td>
</tr>
</tbody></table>
<p>综合而言，在Python中进行列表（迭代器）的处理，列表推导式是更简洁，效率更高的方案，也更Pythonic，不过当列表推导式过于复杂的时候，转而使用<code>for</code>循环会使代码更好理解和可维护。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://duyixian1234.github.io/2019/11/11/%E4%BD%BF%E7%94%A8Python%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="杜逸先">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="那时难决">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/11/%E4%BD%BF%E7%94%A8Python%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/" itemprop="url">使用Python发送邮件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-11T11:12:27+08:00">
                2019-11-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用Python发送邮件"><a href="#使用Python发送邮件" class="headerlink" title="使用Python发送邮件"></a>使用Python发送邮件</h1><p>之前写了一个小工具从远程服务器下载文件，然后通过附件方式发送给自己的邮箱，中间用到了Python里跟邮件相关的两个标准库<code>email</code>和<code>smtp</code>，使用也并不复杂。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">from</span> email <span class="keyword">import</span> encoders</span><br><span class="line"><span class="keyword">from</span> email.mime.base <span class="keyword">import</span> MIMEBase</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List, Tuple</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app.settings <span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line">context = ssl.create_default_context() <span class="comment"># 初始化ssl上下文</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_message</span><span class="params">(sender_email: str, receiver_email: str, subject: str,</span></span></span><br><span class="line"><span class="function"><span class="params">                 content: str,</span></span></span><br><span class="line"><span class="function"><span class="params">                 attachments: List[Tuple[str, bytes]])</span> -&gt; MIMEBase:</span></span><br><span class="line">    message = MIMEMultipart() <span class="comment"># 创建一个Message对象并设置邮件的基本信息</span></span><br><span class="line">    message[<span class="string">'From'</span>] = sender_email</span><br><span class="line">    message[<span class="string">'To'</span>] = receiver_email</span><br><span class="line">    message[<span class="string">'Subject'</span>] = subject</span><br><span class="line">    message[<span class="string">'Bcc'</span>] = receiver_email</span><br><span class="line"></span><br><span class="line">    message.attach(MIMEText(content, <span class="string">'plain'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> name, binary_content <span class="keyword">in</span> attachments: <span class="comment"># 添加附件</span></span><br><span class="line">        attachment = MIMEBase(<span class="string">"application"</span>, <span class="string">"octet-stream"</span>)</span><br><span class="line">        attachment.set_payload(binary_content)</span><br><span class="line">        encoders.encode_base64(attachment)</span><br><span class="line">        attachment.add_header(</span><br><span class="line">            <span class="string">"Content-Disposition"</span>,</span><br><span class="line">            <span class="string">f"attachment; filename= <span class="subst">&#123;name&#125;</span>"</span>,</span><br><span class="line">        )</span><br><span class="line">        message.attach(attachment)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_email</span><span class="params">(receiver_email: str, subject: str, content: str,</span></span></span><br><span class="line"><span class="function"><span class="params">               attachments: List[Tuple[str, bytes]])</span>:</span></span><br><span class="line">    <span class="keyword">with</span> smtplib.SMTP_SSL(config.host, config.port, context=context) <span class="keyword">as</span> server: <span class="comment"># 配置smtp发送服务器</span></span><br><span class="line">        sender_email, password = config.email, config.password</span><br><span class="line">        server.login(sender_email, password) <span class="comment"># 登录邮箱账户</span></span><br><span class="line">        message = make_message(sender_email, receiver_email, subject, content,</span><br><span class="line">                               attachments)</span><br><span class="line">        server.send_message(message, sender_email, receiver_email)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">杜逸先</p>
              <p class="site-description motion-element" itemprop="description">我的技术博客</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives%7C%7C%20archive">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">杜逸先</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>



  <div class="footer-custom"><a target="_blank" href="http://www.beian.miit.gov.cn/">浙ICP备20006538号</a></div>


        




  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=66529623";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
